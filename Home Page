import React, { useState, useEffect } from 'react';
import { 
  Home, Compass, User as UserIcon, MessageSquare, Bell, 
  Bookmark, Settings, LogOut, Heart, MessageCircle, Share2, 
  Plus, Moon, Sun, X, Image as ImageIcon, Hash, CheckCircle,
  Menu, MoreHorizontal, Video, FileText, Search, Briefcase,
  Activity, MonitorPlay, Zap, Trash2
} from 'lucide-react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged 
} from 'firebase/auth';
import { 
  getFirestore, collection, doc, setDoc, getDoc, onSnapshot, 
  addDoc, updateDoc, deleteDoc, arrayUnion, arrayRemove 
} from 'firebase/firestore';

// --- Firebase Initialization ---
const firebaseConfig = {
  apiKey: "AIzaSyAo3raKnYPD1rNrIZvdGhyIZ9B5VtwOGI",
  authDomain: "clustr-42f09.firebaseapp.com",
  projectId: "clustr-42f09",
  storageBucket: "clustr-42f09.firebasestorage.app",
  messagingSenderId: "60199926512",
  appId: "1:60199926512:web:7b69635465460bfddb6035",
  measurementId: "G-5NRSRVYC1Y"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = 'clustr_app_v1';


// --- Main Application Component ---
export default function SkillNet() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [darkMode, setDarkMode] = useState(false); 
  const [currentView, setCurrentView] = useState('home'); 
  
  // Data States
  const [posts, setPosts] = useState([]);
  const [usersInfo, setUsersInfo] = useState({}); 
  
  // Initialize Auth
  useEffect(() => {
    const initAuth = async () => {
      try {
          await signInAnonymously(auth);
      } catch (error) {
        console.error("Auth Error:", error);
      }
    };
    initAuth();

    const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {
      setUser(currentUser);
      if (currentUser) {
        const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', currentUser.uid);
        const userSnap = await getDoc(userRef);
        if (!userSnap.exists()) {
          await setDoc(userRef, {
            uid: currentUser.uid,
            displayName: currentUser.displayName || `User_${currentUser.uid.substring(0, 4)}`,
            photoURL: currentUser.photoURL || `https://i.pravatar.cc/150?u=${currentUser.uid}`,
            skills: ['React', 'Design', 'Product'],
            savedPosts: [],
            role: 'Product Designer',
            bio: 'Exploring ideas and building beautiful digital experiences.',
            joinedAt: Date.now()
          });
        }
      }
      setLoading(false);
    });
    return () => unsubscribe();
  }, []);

  // Fetch Posts & Users
  useEffect(() => {
    if (!user) return;

    const usersRef = collection(db, 'artifacts', appId, 'public', 'data', 'users');
    const unsubscribeUsers = onSnapshot(usersRef, (snapshot) => {
      const usersMap = {};
      snapshot.docs.forEach(doc => {
        usersMap[doc.id] = doc.data();
      });
      setUsersInfo(usersMap);
    }, (err) => console.error("Users fetch error:", err));

    const postsRef = collection(db, 'artifacts', appId, 'public', 'data', 'posts');
    const unsubscribePosts = onSnapshot(postsRef, (snapshot) => {
      const postsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      postsData.sort((a, b) => b.createdAt - a.createdAt);
      
      if (postsData.length === 0 && user) {
        seedInitialPosts(user.uid);
      } else {
        setPosts(postsData);
      }
    }, (err) => console.error("Posts fetch error:", err));

    return () => {
      unsubscribeUsers();
      unsubscribePosts();
    };
  }, [user]);

  const seedInitialPosts = async (uid) => {
    const defaultPosts = [
      {
        authorId: uid,
        content: "Just finished refactoring our core components using React Server Components. The performance gains are incredible! Here's a snippet of the new pattern we're using. Would love to hear your thoughts on this approach. ðŸ‘‡",
        skills: ['React', 'Performance', 'WebDev'],
        imageUrl: "https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=800&q=80",
        likes: [],
        comments: [],
        createdAt: Date.now() - 100000
      },
      {
        authorId: 'system_user', 
        content: "Understanding Express.js middleware is crucial for building robust APIs. Always remember the req -> middleware -> res lifecycle!",
        skills: ['Express', 'Backend', 'API'],
        likes: ['some_user_id'],
        comments: [],
        createdAt: Date.now() - 500000
      }
    ];
    for (const post of defaultPosts) {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'posts'), post);
    }
  };

  if (loading) return (
    <div className="min-h-screen flex items-center justify-center bg-[#FCFAF8] dark:bg-[#050505]">
      <div className="animate-spin rounded-full h-12 w-12 border-b-4 border-orange-500"></div>
    </div>
  );

  return (
    <div className={`min-h-screen transition-colors duration-700 font-sans ${darkMode ? 'dark text-stone-100 bg-[#050505] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-900/10 via-[#0a0a0a] to-[#050505]' : 'bg-[#FCFAF8] text-stone-900 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-50/40 via-[#FCFAF8] to-[#F5F5F4]'}`}>
      <div className="max-w-[1300px] mx-auto flex justify-center gap-8 px-4 relative selection:bg-orange-500/30 selection:text-orange-900 dark:selection:text-orange-100">
        
        {/* Left Sidebar (Navigation) */}
        <SidebarLeft 
          currentView={currentView} 
          setCurrentView={setCurrentView} 
          darkMode={darkMode} 
          setDarkMode={setDarkMode} 
        />

        {/* Main Content Area */}
        <main className="flex-1 max-w-[650px] w-full min-h-screen pb-28 md:pb-0 pt-6">
          
          {/* Top Search Bar (Desktop) */}
          <div className="hidden md:flex relative mb-8 group z-30">
             <Search size={18} className="absolute left-6 top-1/2 -translate-y-1/2 text-stone-400 group-focus-within:text-orange-500 transition-colors duration-300" />
             <input 
               type="text" 
               placeholder="Search projects, skills, or people..." 
               className="w-full bg-white/80 dark:bg-[#121212]/80 backdrop-blur-xl border border-stone-200/50 dark:border-white/5 rounded-full py-4 pl-14 pr-6 shadow-[0_4px_20px_rgb(0,0,0,0.03)] focus:shadow-[0_8px_30px_rgb(249,115,22,0.12)] focus:border-orange-500/40 outline-none text-[15px] text-stone-900 dark:text-stone-100 transition-all duration-500 placeholder-stone-400"
             />
          </div>

          {/* Mobile Header */}
          <div className="md:hidden sticky top-0 z-40 bg-white/80 dark:bg-[#0a0a0a]/80 backdrop-blur-2xl border-b border-stone-200/50 dark:border-white/5 p-4 mb-6 flex justify-between items-center shadow-sm">
            <h1 className="text-xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-amber-500 tracking-tight flex items-center gap-2">
              <Zap size={22} className="fill-orange-500 text-orange-500"/> CLUSTR
            </h1>
            <button onClick={() => setDarkMode(!darkMode)} className="p-2.5 rounded-full hover:bg-stone-100 dark:hover:bg-white/10 text-orange-500 transition-colors active:scale-95">
              {darkMode ? <Sun size={20} /> : <Moon size={20} />}
            </button>
          </div>

          {/* Router Views */}
          {currentView === 'home' && (
            <>
              <CreatePost user={user} usersInfo={usersInfo} />
              <Feed posts={posts} user={user} usersInfo={usersInfo} />
            </>
          )}
          
          {currentView === 'profile' && (
            <ProfileView user={user} usersInfo={usersInfo} posts={posts} />
          )}

          {currentView === 'explore' && (
            <ExploreView />
          )}

          {currentView === 'bookmarks' && (
            <BookmarksView user={user} usersInfo={usersInfo} posts={posts} />
          )}
        </main>

        {/* Right Sidebar (Widgets) */}
        <SidebarRight usersInfo={usersInfo} currentUser={user} />

        {/* Mobile Bottom Navigation (Floating Island) */}
        <MobileNav currentView={currentView} setCurrentView={setCurrentView} />
      </div>
    </div>
  );
}

// --- Components ---

function SidebarLeft({ currentView, setCurrentView, darkMode, setDarkMode }) {
  const mainNav = [
    { id: 'home', label: 'Home', icon: Home },
    { id: 'explore', label: 'Projects', icon: Compass },
    { id: 'messages', label: 'Inbox', icon: MessageSquare },
  ];

  const oppNav = [
    { id: 'recommended', label: 'Recommended', icon: Bell },
    { id: 'bookmarks', label: 'Saved', icon: Bookmark },
    { id: 'profile', label: 'My Profile', icon: UserIcon },
  ];

  const groupNav = [
    { id: 'settings', label: 'Settings', icon: Settings },
  ];

  const renderNav = (items) => (
    <div className="space-y-2">
      {items.map((item) => {
        const Icon = item.icon;
        const isActive = currentView === item.id;
        return (
          <button
            key={item.id}
            onClick={() => setCurrentView(item.id)}
            className={`w-full flex items-center gap-4 px-5 py-4 rounded-[20px] transition-all duration-300 group font-bold ${
              isActive 
                ? 'bg-white dark:bg-[#1a1a1a] text-orange-600 dark:text-orange-400 shadow-[0_8px_20px_rgba(249,115,22,0.1)] dark:shadow-[0_8px_20px_rgba(0,0,0,0.5)] border border-stone-100/50 dark:border-white/5' 
                : 'hover:bg-white/50 dark:hover:bg-white/5 text-stone-500 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 active:scale-[0.98]'
            }`}
          >
            <Icon size={22} className={`${isActive ? 'stroke-[2.5px]' : 'stroke-[2px] text-stone-400 group-hover:text-orange-500 transition-colors'} ${isActive ? '' : 'group-hover:scale-110 transition-transform duration-300'}`} />
            <span className="text-[15px] tracking-wide">{item.label}</span>
          </button>
        );
      })}
    </div>
  );

  return (
    <aside className="hidden md:flex flex-col w-[260px] h-screen sticky top-0 pt-8 pb-8">
      <div className="flex items-center gap-4 px-6 mb-10 group cursor-pointer">
        <div className="w-12 h-12 rounded-[20px] bg-gradient-to-tr from-orange-500 via-orange-400 to-amber-400 flex items-center justify-center text-white shadow-[0_8px_24px_rgba(249,115,22,0.35)] group-hover:shadow-[0_12px_30px_rgba(249,115,22,0.45)] group-hover:-translate-y-0.5 transition-all duration-500">
          <Zap size={24} className="fill-white" />
        </div>
        <span className="text-[26px] font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-orange-600 to-amber-500 dark:from-orange-400 dark:to-amber-300">CLUSTR</span>
      </div>

      <nav className="flex-1 overflow-y-auto pr-2 scrollbar-hide space-y-8">
        <div>
          <h4 className="text-[11px] font-extrabold text-stone-400/80 dark:text-stone-600 mb-3 px-6 uppercase tracking-[0.2em]">Main</h4>
          {renderNav(mainNav)}
        </div>
        
        <div>
          <h4 className="text-[11px] font-extrabold text-stone-400/80 dark:text-stone-600 mb-3 px-6 uppercase tracking-[0.2em]">Opportunities</h4>
          {renderNav(oppNav)}
        </div>

        <div>
          <h4 className="text-[11px] font-extrabold text-stone-400/80 dark:text-stone-600 mb-3 px-6 uppercase tracking-[0.2em]">System</h4>
          {renderNav(groupNav)}
        </div>
      </nav>

      <div className="mt-auto space-y-2 pt-6">
        <button className="w-full flex items-center gap-4 px-5 py-4 rounded-[20px] hover:bg-red-50 dark:hover:bg-red-500/10 text-stone-500 dark:text-stone-500 hover:text-red-600 dark:hover:text-red-400 transition-all duration-300 font-bold group active:scale-[0.98]">
          <LogOut size={22} className="stroke-[2px] group-hover:scale-110 transition-transform" />
          <span className="text-[15px] tracking-wide">Logout</span>
        </button>
      </div>
    </aside>
  );
}

function MobileNav({ currentView, setCurrentView }) {
  return (
    <nav className="md:hidden fixed bottom-6 left-6 right-6 bg-white/90 dark:bg-[#1a1a1a]/90 backdrop-blur-2xl border border-stone-200/50 dark:border-white/10 flex justify-around items-center p-2.5 z-50 rounded-[2rem] shadow-[0_10px_40px_rgba(0,0,0,0.1)] dark:shadow-[0_10px_40px_rgba(0,0,0,0.5)]">
      <button onClick={() => setCurrentView('home')} className={`p-3.5 rounded-3xl transition-all duration-300 ${currentView === 'home' ? 'text-white bg-gradient-to-r from-orange-500 to-amber-500 shadow-md shadow-orange-500/20 scale-105' : 'text-stone-400 hover:text-orange-500'}`}>
        <Home size={24} className={currentView === 'home' ? 'fill-current' : ''} />
      </button>
      <button onClick={() => setCurrentView('explore')} className={`p-3.5 rounded-3xl transition-all duration-300 ${currentView === 'explore' ? 'text-white bg-gradient-to-r from-orange-500 to-amber-500 shadow-md shadow-orange-500/20 scale-105' : 'text-stone-400 hover:text-orange-500'}`}>
        <Compass size={24} />
      </button>
      <button onClick={() => setCurrentView('profile')} className={`p-3.5 rounded-3xl transition-all duration-300 ${currentView === 'profile' ? 'text-white bg-gradient-to-r from-orange-500 to-amber-500 shadow-md shadow-orange-500/20 scale-105' : 'text-stone-400 hover:text-orange-500'}`}>
        <UserIcon size={24} />
      </button>
    </nav>
  );
}

function SidebarRight({ usersInfo, currentUser }) {
  const stories = [
    { id: 1, name: 'Alice', avatar: 'https://i.pravatar.cc/150?u=alice', bg: 'https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?auto=format&fit=crop&w=300&q=80' },
    { id: 2, name: 'Bob', avatar: 'https://i.pravatar.cc/150?u=bob', bg: 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=300&q=80' },
    { id: 3, name: 'Eve', avatar: 'https://i.pravatar.cc/150?u=eve', bg: 'https://images.unsplash.com/photo-1618044733300-9472054094ee?auto=format&fit=crop&w=300&q=80' },
    { id: 4, name: 'David', avatar: 'https://i.pravatar.cc/150?u=admin', bg: 'https://images.unsplash.com/photo-1544197150-b99a580bb7a8?auto=format&fit=crop&w=300&q=80' },
  ];

  const watchlist = [
    { id: 1, title: 'Building Fluid UIs with Framer Motion', author: 'DesignOps', timeAgo: '2 days ago', duration: '14:20', thumb: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=300&q=80' },
    { id: 2, title: 'The Future of Serverless React', author: 'Vercel Team', timeAgo: '5 days ago', duration: '45:12', thumb: 'https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?auto=format&fit=crop&w=300&q=80' },
    { id: 3, title: 'Designing for Accessibility', author: 'A11y Project', timeAgo: '1 week ago', duration: '22:05', thumb: 'https://images.unsplash.com/photo-1563206767-5b18f218e8de?auto=format&fit=crop&w=300&q=80' },
  ];

  const popularCommunities = [
    { id: 1, name: 'c/WebDesign', members: '6,964,945', icon: 'https://api.dicebear.com/7.x/shapes/svg?seed=design' },
    { id: 2, name: 'c/ReactJS', members: '8,614,253', icon: 'https://api.dicebear.com/7.x/shapes/svg?seed=react' },
    { id: 3, name: 'c/UIUX', members: '12,475,541', icon: 'https://api.dicebear.com/7.x/shapes/svg?seed=uiux' },
    { id: 4, name: 'c/Startups', members: '4,222,183', icon: 'https://api.dicebear.com/7.x/shapes/svg?seed=startup' },
    { id: 5, name: 'c/Creative', members: '26,796,461', icon: 'https://api.dicebear.com/7.x/shapes/svg?seed=creative' },
  ];

  return (
    <aside className="hidden lg:block w-[340px] h-screen sticky top-0 pt-8 overflow-y-auto scrollbar-hide pb-10">
      
      {/* Stories */}
      <div className="bg-white/90 dark:bg-[#121212]/90 backdrop-blur-xl rounded-[32px] p-7 mb-6 border border-white dark:border-white/5 shadow-[0_8px_30px_rgba(0,0,0,0.03)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500">
        <div className="flex justify-between items-center mb-6">
          <h3 className="font-extrabold text-[17px] tracking-tight text-stone-900 dark:text-stone-100 flex items-center gap-2">
            <Activity size={20} className="text-orange-500"/> Stories
          </h3>
          <button className="text-[13px] font-bold text-orange-500 hover:text-orange-600 dark:hover:text-orange-400 transition-colors">See all</button>
        </div>
        
        <div className="flex gap-4 overflow-x-auto scrollbar-hide pb-2 snap-x">
          {stories.map(story => (
            <div key={story.id} className="relative w-[110px] h-[165px] rounded-[24px] flex-shrink-0 overflow-hidden group cursor-pointer shadow-sm snap-start">
              <img src={story.bg} className="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 opacity-90" alt="story bg" />
              <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
              
              <div className="absolute bottom-4 left-0 right-0 flex flex-col items-center">
                <img src={story.avatar} className="w-12 h-12 rounded-full border-[3px] border-white dark:border-[#1a1a1a] mb-2 object-cover bg-white shadow-md ring-2 ring-transparent group-hover:ring-orange-500/50 transition-all duration-500" alt={story.name} />
                <span className="text-[13px] font-bold text-white truncate w-full text-center px-2 drop-shadow-md">{story.name}</span>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Watchlist */}
      <div className="bg-white/90 dark:bg-[#121212]/90 backdrop-blur-xl rounded-[32px] p-7 mb-6 border border-white dark:border-white/5 shadow-[0_8px_30px_rgba(0,0,0,0.03)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500">
        <div className="flex justify-between items-center mb-6">
          <h3 className="font-extrabold text-[17px] tracking-tight text-stone-900 dark:text-stone-100 flex items-center gap-2">
            <MonitorPlay size={20} className="text-orange-500"/> Watchlist
          </h3>
          <button className="text-[13px] font-bold text-orange-500 hover:text-orange-600 dark:hover:text-orange-400 transition-colors">See all</button>
        </div>

        <div className="space-y-6">
          {watchlist.map(video => (
            <div key={video.id} className="flex gap-4 group cursor-pointer">
              <div className="relative w-[125px] h-[80px] rounded-[16px] overflow-hidden flex-shrink-0 shadow-sm group-hover:shadow-md transition-all duration-500">
                <img src={video.thumb} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700 opacity-95" alt="thumb" />
                <div className="absolute bottom-1.5 right-1.5 bg-black/70 backdrop-blur-md px-2 py-0.5 rounded-lg flex items-center justify-center border border-white/10">
                  <span className="text-[10px] font-bold tracking-wide text-white">{video.duration}</span>
                </div>
              </div>
              <div className="flex-1 min-w-0 flex flex-col justify-center">
                <h4 className="text-[14px] font-bold text-stone-800 dark:text-stone-200 group-hover:text-orange-600 dark:group-hover:text-orange-400 line-clamp-2 leading-snug mb-1 transition-colors">{video.title}</h4>
                <p className="text-[12px] text-stone-500 font-medium truncate">{video.author}</p>
                <p className="text-[11px] text-stone-400 dark:text-stone-500 mt-0.5">{video.timeAgo}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Popular Communities */}
      <div className="bg-white/90 dark:bg-[#121212]/90 backdrop-blur-xl rounded-[32px] p-7 mb-6 border border-white dark:border-white/5 shadow-[0_8px_30px_rgba(0,0,0,0.03)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500">
        <h3 className="font-extrabold text-[17px] tracking-tight text-stone-900 dark:text-stone-100 mb-6 flex items-center gap-2">
           <Hash size={20} className="text-orange-500"/> Popular Communities
        </h3>
        <div className="space-y-5">
          {popularCommunities.map(community => (
            <div key={community.id} className="flex items-center gap-4 group cursor-pointer">
              <div className="relative">
                <img src={community.icon} alt={community.name} className="w-12 h-12 rounded-[16px] bg-[#FCFAF8] dark:bg-stone-800/50 border border-stone-100 dark:border-stone-700 p-2 group-hover:bg-orange-50 dark:group-hover:bg-orange-500/10 transition-colors z-10 relative shadow-sm" />
                <div className="absolute inset-0 bg-orange-500/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              </div>
              <div className="flex-1 min-w-0">
                <h4 className="text-[14.5px] font-bold text-stone-800 dark:text-stone-200 group-hover:text-orange-600 dark:group-hover:text-orange-400 truncate transition-colors">{community.name}</h4>
                <p className="text-[12px] text-stone-500 dark:text-stone-400 font-medium truncate mt-0.5">{community.members} members</p>
              </div>
            </div>
          ))}
        </div>
        <button className="mt-7 w-full py-3.5 bg-[#FCFAF8] dark:bg-white/5 text-[14px] font-bold text-stone-700 dark:text-stone-300 rounded-[16px] hover:bg-stone-100 dark:hover:bg-white/10 transition-colors active:scale-95 shadow-sm">
          Explore Network
        </button>
      </div>

    </aside>
  );
}

function CreatePost({ user, usersInfo }) {
  const [content, setContent] = useState('');
  const [mediaUrl, setMediaUrl] = useState('');
  const [showMediaInput, setShowMediaInput] = useState(false);
  const [isPublishing, setIsPublishing] = useState(false);
  const currentUserData = usersInfo[user?.uid] || {};

  const handlePost = async () => {
    if (!content.trim() && !mediaUrl.trim()) return;
    setIsPublishing(true);
    try {
      await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'posts'), {
        authorId: user.uid,
        content,
        mediaUrl: mediaUrl.trim(),
        likes: [],
        comments: [],
        createdAt: Date.now()
      });
      setContent('');
      setMediaUrl('');
      setShowMediaInput(false);
    } catch (error) {
      console.error("Error creating post", error);
    }
    setIsPublishing(false);
  };

  return (
    <div className="bg-white/80 dark:bg-[#121212]/80 backdrop-blur-2xl border border-white dark:border-white/5 rounded-[32px] p-7 mb-8 shadow-[0_8px_30px_rgba(0,0,0,0.04)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500 relative z-20">
      <div className="flex gap-4 mb-4">
        <img 
          src={currentUserData.photoURL || `https://i.pravatar.cc/150?u=${user?.uid}`} 
          alt="Avatar" 
          className="w-12 h-12 rounded-full border-[3px] border-white dark:border-[#1a1a1a] flex-shrink-0 object-cover shadow-md bg-[#FCFAF8] dark:bg-stone-900"
        />
        <div className="flex-1">
          <textarea
            value={content}
            onChange={(e) => setContent(e.target.value)}
            placeholder="Share what you're working on or thinking about..."
            className="w-full bg-transparent border-none resize-none outline-none text-[17px] min-h-[60px] text-stone-900 dark:text-stone-100 placeholder-stone-400 mt-2 font-medium"
          />
        </div>
      </div>

      {showMediaInput && (
        <div className="mb-6 pl-16 pr-2">
          <input 
            type="text" 
            value={mediaUrl}
            onChange={(e) => setMediaUrl(e.target.value)}
            placeholder="Paste Image or Video URL..."
            className="w-full bg-[#FCFAF8] dark:bg-[#0a0a0a] border border-stone-200/80 dark:border-white/5 rounded-[16px] p-4 text-[14px] outline-none focus:ring-2 focus:ring-orange-500/40 focus:border-orange-500 transition-all text-stone-900 dark:text-stone-100 placeholder-stone-400 shadow-inner"
          />
        </div>
      )}

      <div className="flex justify-between items-center pl-14 pr-2 pt-5 border-t border-stone-100 dark:border-white/5">
        <div className="flex items-center gap-2 sm:gap-4">
          <button 
            onClick={() => setShowMediaInput(!showMediaInput)}
            className="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-[#FCFAF8] dark:hover:bg-white/5 transition-colors text-orange-500 hover:text-orange-600 group active:scale-95"
          >
            <Video size={20} className="group-hover:scale-110 transition-transform"/> <span className="text-[14px] font-bold hidden sm:inline text-stone-500 dark:text-stone-400 group-hover:text-stone-700 dark:group-hover:text-stone-200">Video</span>
          </button>
          <button 
            onClick={() => setShowMediaInput(!showMediaInput)}
            className="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-[#FCFAF8] dark:hover:bg-white/5 transition-colors text-orange-500 hover:text-orange-600 group active:scale-95"
          >
            <ImageIcon size={20} className="group-hover:scale-110 transition-transform"/> <span className="text-[14px] font-bold hidden sm:inline text-stone-500 dark:text-stone-400 group-hover:text-stone-700 dark:group-hover:text-stone-200">Photo</span>
          </button>
          <button 
            className="flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-[#FCFAF8] dark:hover:bg-white/5 transition-colors text-orange-500 hover:text-orange-600 group active:scale-95"
          >
            <FileText size={20} className="group-hover:scale-110 transition-transform"/> <span className="text-[14px] font-bold hidden sm:inline text-stone-500 dark:text-stone-400 group-hover:text-stone-700 dark:group-hover:text-stone-200">Article</span>
          </button>
        </div>
        
        <button 
          onClick={handlePost}
          disabled={isPublishing || (!content.trim() && !mediaUrl.trim())}
          className="bg-gradient-to-r from-orange-500 via-orange-500 to-amber-500 hover:from-orange-600 hover:via-orange-500 hover:to-amber-500 text-white px-8 py-3 rounded-[18px] font-bold text-[15px] transition-all duration-300 shadow-[0_4px_15px_rgba(249,115,22,0.3)] hover:shadow-[0_8px_25px_rgba(249,115,22,0.4)] hover:-translate-y-0.5 active:scale-95 disabled:opacity-50 disabled:hover:translate-y-0 disabled:hover:shadow-[0_4px_15px_rgba(249,115,22,0.3)] disabled:active:scale-100"
        >
          {isPublishing ? 'Posting...' : 'Post'}
        </button>
      </div>
    </div>
  );
}

function Feed({ posts, user, usersInfo }) {
  if (posts.length === 0) {
    return (
      <div className="p-12 text-center bg-white/80 dark:bg-[#121212]/80 backdrop-blur-2xl rounded-[32px] border border-white dark:border-white/5 shadow-[0_8px_30px_rgba(0,0,0,0.04)] flex flex-col items-center gap-4">
        <div className="w-16 h-16 bg-orange-50 dark:bg-orange-500/10 rounded-full flex items-center justify-center">
          <Activity size={24} className="text-orange-500"/>
        </div>
        <p className="text-stone-500 font-bold text-[15px]">No content available yet. Be the first to share!</p>
      </div>
    );
  }

  return (
    <div className="pb-12 space-y-8">
      {posts.map(post => (
        <PostCard key={post.id} post={post} user={user} usersInfo={usersInfo} />
      ))}
    </div>
  );
}

function PostCard({ post, user, usersInfo }) {
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [showComments, setShowComments] = useState(false);
  const [commentText, setCommentText] = useState('');
  const [isCommenting, setIsCommenting] = useState(false);

  const author = usersInfo[post.authorId] || { 
    displayName: 'Unknown User', 
    role: 'Member',
    photoURL: `https://i.pravatar.cc/150?u=${post.authorId}`,
    skills: []
  };
  
  const currentUserData = usersInfo[user?.uid] || {};
  const isSaved = currentUserData.savedPosts?.includes(post.id);

  const isLiked = post.likes?.includes(user?.uid);
  const media = post.mediaUrl || post.imageUrl;
  const isVideo = media && media.match(/\.(mp4|webm|ogg)$/i);

  const timeAgo = (timestamp) => {
    const diff = Date.now() - timestamp;
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    if (days > 0) return `${days}d ago`;
    if (hours > 0) return `${hours}h ago`;
    if (minutes > 0) return `${minutes}m ago`;
    return 'Just now';
  };

  const handleLike = async () => {
    if (!user) return;
    const postRef = doc(db, 'artifacts', appId, 'public', 'data', 'posts', post.id);
    try {
      if (isLiked) {
        await updateDoc(postRef, { likes: arrayRemove(user.uid) });
      } else {
        await updateDoc(postRef, { likes: arrayUnion(user.uid) });
      }
    } catch (err) {
      console.error("Like error", err);
    }
  };

  const handleDelete = async () => {
    if (!user || user.uid !== post.authorId) return;
    try {
      await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'posts', post.id));
    } catch (err) {
      console.error("Delete error", err);
    }
  };

  const handleAddComment = async () => {
    if (!user || !commentText.trim()) return;
    setIsCommenting(true);
    const postRef = doc(db, 'artifacts', appId, 'public', 'data', 'posts', post.id);
    try {
      const newComment = {
        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
        authorId: user.uid,
        text: commentText.trim(),
        createdAt: Date.now()
      };
      await updateDoc(postRef, { 
        comments: arrayUnion(newComment) 
      });
      setCommentText('');
    } catch (err) {
      console.error("Comment error", err);
    }
    setIsCommenting(false);
  };

  const handleSave = async () => {
    if (!user) return;
    const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', user.uid);
    try {
      if (isSaved) {
        await updateDoc(userRef, { savedPosts: arrayRemove(post.id) });
      } else {
        await updateDoc(userRef, { savedPosts: arrayUnion(post.id) });
      }
    } catch (err) {
      console.error("Save error", err);
    }
  };

  return (
    <div className="bg-white/90 dark:bg-[#121212]/90 backdrop-blur-xl border border-white dark:border-white/5 rounded-[32px] p-7 shadow-[0_8px_30px_rgba(0,0,0,0.03)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500 relative z-10">
      {/* Header */}
      <div className="flex items-center gap-4 mb-5">
        <img src={author.photoURL} alt={author.displayName} className="w-12 h-12 rounded-full object-cover border-[3px] border-stone-50 dark:border-[#1a1a1a] shadow-sm bg-[#FCFAF8] dark:bg-stone-900" />
        
        <div className="flex-1">
          <div className="flex justify-between items-start">
            <div>
              <div className="flex items-center gap-1.5">
                <span className="font-extrabold text-[16px] tracking-tight text-stone-900 dark:text-stone-100 hover:text-orange-500 transition-colors cursor-pointer">{author.displayName}</span>
                {author.verified && <CheckCircle size={15} className="text-orange-500" />}
              </div>
              <div className="text-[13px] font-bold text-stone-500 dark:text-stone-400 mt-0.5">{author.role || author.skills?.[0] || 'Software Engineer'}</div>
              <div className="text-[12px] font-semibold text-stone-400 dark:text-stone-500 mt-0.5">{timeAgo(post.createdAt)}</div>
            </div>
            <div className="flex items-center gap-1 relative">
              <button 
                onClick={() => setIsMenuOpen(!isMenuOpen)} 
                className="text-stone-400 hover:text-stone-700 dark:hover:text-stone-200 transition-colors p-2 rounded-full hover:bg-stone-100 dark:hover:bg-white/5 active:scale-95"
              >
                <MoreHorizontal size={20} />
              </button>

              {isMenuOpen && (
                <div className="absolute right-0 top-12 w-48 bg-white/95 dark:bg-[#1a1a1a]/95 backdrop-blur-2xl border border-stone-100 dark:border-white/10 rounded-[20px] shadow-[0_10px_40px_rgba(0,0,0,0.1)] dark:shadow-[0_10px_40px_rgba(0,0,0,0.5)] z-20 py-2 overflow-hidden">
                  {user?.uid === post.authorId && (
                    <button 
                      onClick={() => { handleDelete(); setIsMenuOpen(false); }} 
                      className="w-full flex items-center gap-3 px-5 py-3 text-[14px] font-bold text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 transition-colors text-left"
                    >
                      <Trash2 size={18} /> Delete Post
                    </button>
                  )}
                  <button 
                    onClick={() => setIsMenuOpen(false)} 
                    className="w-full flex items-center gap-3 px-5 py-3 text-[14px] font-bold text-stone-600 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-white/5 transition-colors text-left"
                  >
                    Cancel
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="mb-6">
        <p className="text-[16px] text-stone-800 dark:text-stone-200 leading-relaxed whitespace-pre-wrap font-medium">{post.content}</p>
        
        {/* Skills */}
        {post.skills && post.skills.length > 0 && (
          <div className="flex flex-wrap gap-2.5 mt-4">
            {post.skills.map(skill => (
              <span key={skill} className="bg-orange-50/80 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-100/50 dark:border-orange-500/20 font-bold text-[13px] px-3.5 py-1.5 rounded-full hover:bg-orange-100 dark:hover:bg-orange-500/20 cursor-pointer transition-colors shadow-sm">
                #{skill}
              </span>
            ))}
          </div>
        )}
      </div>

      {/* Media */}
      {media && (
        <div className="mb-6 rounded-[24px] overflow-hidden border border-stone-100 dark:border-white/5 bg-[#FCFAF8] dark:bg-[#0a0a0a] shadow-sm relative group cursor-pointer">
          {isVideo ? (
            <video src={media} controls className="w-full h-auto object-cover max-h-[500px]" />
          ) : (
            <>
              <img src={media} alt="Post media" className="w-full h-auto object-cover max-h-[500px] transition-transform duration-700 group-hover:scale-[1.02]" />
              <div className="absolute inset-0 bg-black/0 group-hover:bg-black/5 transition-colors duration-500 pointer-events-none"></div>
            </>
          )}
        </div>
      )}

      {/* Actions */}
      <div className="flex items-center justify-between pt-5 text-stone-500 dark:text-stone-400 border-t border-stone-100 dark:border-white/5">
        <div className="flex gap-2 sm:gap-6">
          <button 
            onClick={handleLike}
            className={`flex items-center gap-2.5 group transition-colors px-3 py-2 rounded-xl hover:bg-orange-50 dark:hover:bg-orange-500/10 hover:text-orange-500 active:scale-95 ${isLiked ? 'text-orange-500' : ''}`}
          >
            <Heart size={22} className={`${isLiked ? 'fill-current text-orange-500' : ''} group-hover:scale-110 transition-transform`} />
            <span className="text-[15px] font-bold">{post.likes?.length || 0}</span>
          </button>
          
          <button 
            onClick={() => setShowComments(!showComments)}
            className="flex items-center gap-2.5 group transition-colors px-3 py-2 rounded-xl hover:bg-orange-50 dark:hover:bg-orange-500/10 hover:text-orange-500 active:scale-95"
          >
            <MessageCircle size={22} className="group-hover:scale-110 transition-transform" />
            <span className="text-[15px] font-bold">{post.comments?.length || 0}</span>
          </button>
          
          <button className="flex items-center gap-2.5 group transition-colors px-3 py-2 rounded-xl hover:bg-orange-50 dark:hover:bg-orange-500/10 hover:text-orange-500 active:scale-95">
            <Share2 size={22} className="group-hover:scale-110 transition-transform" />
            <span className="hidden sm:inline text-[15px] font-bold">Share</span>
          </button>
        </div>

        <button onClick={handleSave} className={`flex items-center gap-2.5 group transition-colors px-3 py-2 rounded-xl hover:bg-orange-50 dark:hover:bg-orange-500/10 hover:text-orange-500 active:scale-95 ${isSaved ? 'text-orange-500' : ''}`}>
          <Bookmark size={22} className={`${isSaved ? 'fill-current text-orange-500' : ''} group-hover:scale-110 transition-transform`} />
        </button>
      </div>

      {/* Comments Section */}
      {showComments && (
        <div className="mt-5 pt-5 border-t border-stone-100 dark:border-white/5 space-y-5 animate-in slide-in-from-top-2 fade-in duration-300">
          {/* Comment Input */}
          <div className="flex gap-3 items-center">
            <img 
              src={usersInfo[user?.uid]?.photoURL || `https://i.pravatar.cc/150?u=${user?.uid}`} 
              alt="Your avatar" 
              className="w-10 h-10 rounded-full object-cover border-2 border-stone-100 dark:border-stone-800 bg-[#FCFAF8] dark:bg-stone-900 shadow-sm"
            />
            <div className="flex-1 relative flex items-center">
              <input 
                type="text" 
                value={commentText}
                onChange={(e) => setCommentText(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handleAddComment()}
                placeholder="Write a comment..."
                className="w-full bg-[#FCFAF8] dark:bg-[#0a0a0a] border border-stone-200/80 dark:border-white/5 rounded-full py-2.5 pl-5 pr-20 text-[14px] outline-none focus:ring-2 focus:ring-orange-500/40 focus:border-orange-500 transition-all text-stone-900 dark:text-stone-100 placeholder-stone-400 shadow-inner"
              />
              <button 
                onClick={handleAddComment} 
                disabled={isCommenting || !commentText.trim()} 
                className="absolute right-1.5 bg-orange-500 hover:bg-orange-600 text-white rounded-full px-4 py-1.5 text-[12px] font-bold transition-colors disabled:opacity-50 disabled:hover:bg-orange-500 active:scale-95 shadow-sm"
              >
                Post
              </button>
            </div>
          </div>

          {/* Comments List */}
          {post.comments && post.comments.length > 0 && (
            <div className="space-y-5 max-h-[350px] overflow-y-auto scrollbar-hide pr-1 pt-2">
              {[...post.comments].sort((a, b) => b.createdAt - a.createdAt).map((c) => {
                const cAuthor = usersInfo[c.authorId] || { 
                  displayName: 'Unknown User', 
                  photoURL: `https://i.pravatar.cc/150?u=${c.authorId}` 
                };
                return (
                  <div key={c.id} className="flex gap-3">
                    <img src={cAuthor.photoURL} className="w-9 h-9 rounded-full object-cover border border-stone-200 dark:border-stone-700 mt-1 shadow-sm" />
                    <div className="flex-1">
                      <div className="bg-[#FCFAF8] dark:bg-[#1a1a1a] p-3.5 rounded-[20px] rounded-tl-sm border border-stone-200/50 dark:border-white/5 shadow-sm inline-block min-w-[120px] max-w-full">
                        <p className="text-[13px] font-extrabold text-stone-900 dark:text-stone-100">{cAuthor.displayName}</p>
                        <p className="text-[14px] text-stone-700 dark:text-stone-300 mt-0.5 font-medium whitespace-pre-wrap">{c.text}</p>
                      </div>
                      <p className="text-[11px] text-stone-400 dark:text-stone-500 mt-1.5 ml-2 font-semibold tracking-wide">
                        {timeAgo(c.createdAt)}
                      </p>
                    </div>
                  </div>
                );
              })}
            </div>
          )}
        </div>
      )}
    </div>
  );
}

function ProfileView({ user, usersInfo, posts }) {
  const [editing, setEditing] = useState(false);
  const [bio, setBio] = useState('');
  const [role, setRole] = useState('');
  const [newSkill, setNewSkill] = useState('');
  
  const currentUserData = usersInfo[user?.uid] || {};
  const userPosts = posts.filter(p => p.authorId === user?.uid);

  useEffect(() => {
    if (currentUserData.bio) setBio(currentUserData.bio);
    if (currentUserData.role) setRole(currentUserData.role);
  }, [currentUserData]);

  const saveProfile = async () => {
    const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', user.uid);
    await updateDoc(userRef, { bio, role });
    setEditing(false);
  };

  const addProfileSkill = async () => {
    if (!newSkill.trim()) return;
    const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', user.uid);
    await updateDoc(userRef, { skills: arrayUnion(newSkill.trim()) });
    setNewSkill('');
  };

  const removeProfileSkill = async (skillToRemove) => {
    const userRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', user.uid);
    await updateDoc(userRef, { skills: arrayRemove(skillToRemove) });
  };

  return (
    <div className="pb-12 min-h-screen">
      {/* Cover Image */}
      <div className="h-48 md:h-64 rounded-t-[36px] bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-orange-400 via-rose-500 to-amber-500 relative overflow-hidden shadow-inner border border-white/20">
        <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-20 mix-blend-overlay"></div>
        <div className="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
      </div>
      
      {/* Profile Info */}
      <div className="px-8 pb-10 bg-white/90 dark:bg-[#121212]/90 backdrop-blur-2xl rounded-b-[36px] border border-white dark:border-white/5 shadow-[0_10px_40px_rgba(0,0,0,0.05)] mb-8 relative">
        <div className="flex justify-between items-end -mt-16 md:-mt-20 mb-6 relative z-10">
          <div className="relative group">
            <img 
              src={currentUserData.photoURL} 
              alt="Profile" 
              className="w-32 h-32 md:w-40 md:h-40 rounded-full border-[6px] border-white dark:border-[#1a1a1a] bg-[#FCFAF8] dark:bg-stone-900 object-cover shadow-xl relative z-10"
            />
            <div className="absolute inset-0 rounded-full ring-2 ring-orange-500/20 scale-[1.03] pointer-events-none transition-transform duration-500 group-hover:scale-110"></div>
          </div>
          <button 
            onClick={() => setEditing(!editing)}
            className="bg-white dark:bg-[#1a1a1a] border border-stone-200 dark:border-white/10 text-stone-700 dark:text-stone-300 hover:bg-[#FCFAF8] dark:hover:bg-white/5 hover:text-orange-500 dark:hover:text-orange-400 font-bold text-[14px] px-6 py-2.5 rounded-full transition-all duration-300 mb-4 shadow-sm hover:shadow-md active:scale-95"
          >
            {editing ? 'Cancel' : 'Edit Profile'}
          </button>
        </div>

        <div>
          <h1 className="text-[32px] font-black text-stone-900 dark:text-stone-100 tracking-tight">{currentUserData.displayName}</h1>
          
          {editing ? (
            <div className="mt-6 space-y-4">
               <input 
                type="text"
                value={role}
                onChange={(e) => setRole(e.target.value)}
                className="w-full bg-[#FCFAF8] dark:bg-[#0a0a0a] border border-stone-200/80 dark:border-white/5 rounded-2xl p-4 text-[15px] outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 transition-all text-stone-900 dark:text-stone-100 placeholder-stone-400 shadow-inner"
                placeholder="Professional Title/Role..."
              />
              <textarea 
                value={bio}
                onChange={(e) => setBio(e.target.value)}
                className="w-full bg-[#FCFAF8] dark:bg-[#0a0a0a] border border-stone-200/80 dark:border-white/5 rounded-2xl p-4 text-[15px] outline-none focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500 transition-all min-h-[120px] text-stone-900 dark:text-stone-100 placeholder-stone-400 shadow-inner"
                placeholder="Tell the network about yourself..."
              />
              <button onClick={saveProfile} className="bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white px-8 py-3 rounded-2xl text-[15px] font-bold shadow-[0_4px_15px_rgba(249,115,22,0.3)] transition-all duration-300 hover:-translate-y-0.5 active:scale-95 mt-2">Save Changes</button>
            </div>
          ) : (
            <>
              <p className="text-stone-600 dark:text-stone-400 text-[17px] mt-1.5 font-bold">{currentUserData.role || 'Member'}</p>
              <p className="mt-4 text-[16px] text-stone-800 dark:text-stone-200 leading-relaxed max-w-2xl font-medium">{currentUserData.bio}</p>
            </>
          )}

          {/* User Skills */}
          <div className="mt-8">
            <h3 className="text-[12px] font-extrabold text-stone-400/80 dark:text-stone-600 mb-4 uppercase tracking-[0.2em]">Top Skills</h3>
            <div className="flex flex-wrap gap-3">
              {currentUserData.skills?.map(skill => (
                <span key={skill} className="bg-white dark:bg-[#1a1a1a] border border-stone-200/80 dark:border-white/5 px-4 py-2.5 rounded-2xl text-[14px] font-bold text-orange-600 dark:text-orange-400 flex items-center gap-2 shadow-sm hover:shadow-md transition-shadow">
                  {skill}
                  {editing && (
                    <button onClick={() => removeProfileSkill(skill)} className="text-red-500 hover:text-white hover:bg-red-500 bg-red-50 dark:bg-red-500/10 rounded-full p-1 transition-colors"><X size={14}/></button>
                  )}
                </span>
              ))}
              {editing && (
                <div className="flex items-center gap-2 bg-[#FCFAF8] dark:bg-[#0a0a0a] border border-stone-200/80 dark:border-white/5 rounded-2xl pr-2 shadow-inner focus-within:ring-2 focus-within:ring-orange-500/50 transition-all">
                  <input 
                    type="text" 
                    value={newSkill}
                    onChange={(e)=>setNewSkill(e.target.value)}
                    placeholder="Add skill..."
                    className="bg-transparent text-[14px] font-bold text-stone-900 dark:text-stone-100 w-32 pl-4 py-3 outline-none placeholder-stone-400"
                    onKeyDown={(e) => e.key === 'Enter' && addProfileSkill()}
                  />
                  <button onClick={addProfileSkill} className="text-white bg-orange-500 hover:bg-orange-600 p-2 rounded-[12px] mr-1 transition-colors shadow-sm active:scale-95"><Plus size={16}/></button>
                </div>
              )}
            </div>
          </div>
          
          <div className="flex gap-10 mt-10 text-[15px] text-stone-500 dark:text-stone-400 border-t border-stone-100 dark:border-white/5 pt-6">
            <span className="cursor-pointer group"><strong className="text-stone-900 dark:text-stone-100 text-2xl font-black mr-2 group-hover:text-orange-500 transition-colors">124</strong> <span className="font-bold">Following</span></span>
            <span className="cursor-pointer group"><strong className="text-stone-900 dark:text-stone-100 text-2xl font-black mr-2 group-hover:text-orange-500 transition-colors">1.2k</strong> <span className="font-bold">Followers</span></span>
          </div>
        </div>
      </div>

      {/* User's Posts */}
      <div className="mt-4 space-y-8">
        <h2 className="font-extrabold text-stone-900 dark:text-stone-100 text-[22px] flex items-center gap-3 px-2 tracking-tight">
           <Activity size={24} className="text-orange-500"/> Recent Activity
        </h2>
        {userPosts.length === 0 ? (
          <div className="p-12 text-center text-stone-500 dark:text-stone-400 font-bold bg-white/80 dark:bg-[#121212]/80 backdrop-blur-2xl rounded-[32px] border border-white dark:border-white/5 shadow-sm">No activity recorded yet.</div>
        ) : (
          userPosts.map(post => (
            <PostCard key={post.id} post={post} user={user} usersInfo={usersInfo} />
          ))
        )}
      </div>
    </div>
  );
}

function ExploreView() {
  const categories = [
    { title: 'Frontend Architecture', tags: ['React', 'Vue', 'CSS', 'Tailwind'] },
    { title: 'Backend Systems', tags: ['Node.js', 'Python', 'Go', 'Databases'] },
    { title: 'Security & Auth', tags: ['Cryptography', 'OAuth', 'PenTesting'] },
    { title: 'Cloud & DevOps', tags: ['AWS', 'Docker', 'Kubernetes', 'CI/CD'] },
  ];

  return (
    <div className="min-h-screen">
      <h2 className="text-[32px] font-black text-stone-900 dark:text-stone-100 mb-8 flex items-center gap-3 tracking-tight">
        <Compass size={36} className="text-orange-500"/> Explore Network
      </h2>
      <div className="grid gap-6">
        {categories.map((cat, i) => (
          <div key={i} className="bg-white/90 dark:bg-[#121212]/90 backdrop-blur-xl rounded-[32px] p-8 border border-white dark:border-white/5 shadow-[0_8px_30px_rgba(0,0,0,0.03)] hover:shadow-[0_12px_40px_rgba(0,0,0,0.06)] transition-all duration-500">
            <h3 className="text-xl font-extrabold text-stone-900 dark:text-stone-100 mb-6 tracking-tight">{cat.title}</h3>
            <div className="flex flex-wrap gap-3.5">
              {cat.tags.map(tag => (
                <button key={tag} className="px-5 py-3 bg-[#FCFAF8] dark:bg-[#1a1a1a] hover:bg-orange-50 dark:hover:bg-orange-500/10 text-stone-700 dark:text-stone-300 hover:text-orange-600 dark:hover:text-orange-400 rounded-2xl font-bold text-[14px] transition-all duration-300 border border-stone-200/50 dark:border-white/5 hover:border-orange-200 dark:hover:border-orange-500/30 shadow-sm hover:shadow-md active:scale-95">
                  {tag}
                </button>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function BookmarksView({ user, usersInfo, posts }) {
  const currentUserData = usersInfo[user?.uid] || {};
  const savedPostIds = currentUserData.savedPosts || [];
  const savedPosts = posts.filter(p => savedPostIds.includes(p.id));

  return (
    <div className="min-h-screen">
      <h2 className="text-[32px] font-black text-stone-900 dark:text-stone-100 mb-8 flex items-center gap-3 tracking-tight px-2">
        <Bookmark size={36} className="text-orange-500"/> Saved Content
      </h2>
      {savedPosts.length === 0 ? (
        <div className="p-12 text-center text-stone-500 dark:text-stone-400 font-bold bg-white/80 dark:bg-[#121212]/80 backdrop-blur-2xl rounded-[32px] border border-white dark:border-white/5 shadow-sm">
          No saved posts yet. Bookmark some interesting posts to see them here!
        </div>
      ) : (
        <div className="pb-12 space-y-8">
          {savedPosts.map(post => (
            <PostCard key={post.id} post={post} user={user} usersInfo={usersInfo} />
          ))}
        </div>
      )}
    </div>
  );
}
